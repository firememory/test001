var debug=!1;!function(a){var b=window.Stock={},c=["timeshare","day","week","month","5min","15min","30min","60min"],d=["/RoxMarket/timeshare","/RoxMarket/klinedaily","/RoxMarket/klineweekly","/RoxMarket/klinemonthly","/RoxMarket/kline5min","/RoxMarket/kline15min","/RoxMarket/kline30min","/RoxMarket/kline60min"];b.websocket=null,b.channelGate=null,b.connect=function(c){try{if(b.close(),"WebSocket"in window)b.websocket=new WebSocket(c);else{if(!("MozWebSocket"in window))return console.log("Error: WebSocket is not supported by this browser."),void 0;b.websocket=new MozWebSocket(c)}b.websocket.onopen=function(){},b.websocket.onclose=function(){},b.websocket.onmessage=function(c){try{var e,d=JSON.parse(c.data);b.graphic&&(a(".line-scroller .minuts-line").hasClass("selected")||d&&d.items&&d.items.length>0&&(e=d.items[0].time,b.graphic.popData(e)),b.graphic.pushData(d),b.graphic.refresh())}catch(f){console.log(f)}}}catch(d){b.close()}finally{}},b.initConnection=function(a){"http:"==window.location.protocol?b.connect("ws://"+window.location.host+a):b.connect("wss://"+window.location.host+a)},b.graphic=null,b.load=function(a,d,e){try{b.graphic=0==d.flag?new MinsGraphic({el:".selectedDetail .canvas0",period:c[d.flag],onRegion:function(){window.pageObject.setTechnical()},onFilish:function(){window.pageObject.filishGraphic()}}):new KGraphic({el:".selectedDetail .canvas0",period:c[d.flag],rightRegion:14,hintChart:!0,technical:d.tech,onRegion:function(){window.pageObject.setTechnical()},onFilish:function(){window.pageObject.filishGraphic()}}),b.graphic.render(d.data),e||b.initConnection(a+"&size="+d.size)}catch(f){jMessage.open({title:"",content:debug?f.message:"数据加载异常，请稍后再试!",model:"alert",autoHide:!1}),window.pageObject.bindKlineButton()}},b.open=function(c,e){("MozWebSocket"in window||"WebSocket"in window)&&!a.isAndroidOS()?b.load(d[e.flag]+c.substring(c.indexOf("?")),e):(b.load("",e,!0),b.channelGate=window.setTimeout(function(){pageObject.bindStock(c,e,!1)},5e3))},b.close=function(){try{b.websocket?b.websocket.close():b.channelGate&&window.clearTimeout(b.channelGate)}catch(a){}finally{b.websocket=null,b.channelGate=null}}}(Zepto),function(a){var b=50,c=window.Stock,d=["/RoxMarket/ts/getData.do?code=","/RoxMarket/daily/getKline.do?code=","/RoxMarket/quote/getWeeklyKline.do?code=","/RoxMarket/quote/getMonthlyKline.do?code=","/RoxMarket/quote/get5MinKLine.do?code=","/RoxMarket/quote/get15MinKLine.do?code=","/RoxMarket/quote/get30MinKLine.do?code=","/RoxMarket/quote/get60MinKLine.do?code="],e=window.pageObject={init:function(b){var e,f,c=b;this.el=c.el&&a(c.el)||a(""),this.options=c,this.setContent(),this.unBindEvents(),this.bindEvents(),e="lineIndex"in this.options?this.options.lineIndex:0,f="tech"in this.options?this.options.tech:"VOL",this.bindStock(d[e]+this.options.stockCode,{flag:e,tech:f})},setContent:function(){var b="lineIndex"in this.options?this.options.lineIndex:0;a(".line-scroller>div>div").removeClass("selected").eq(b).addClass("selected"),this.setCanvasHeight(),this.getSiblingStockCode()},setMaxSize:function(){var d=new KGraphic({el:".selectedDetail .canvas0",hintChart:!0}),e=new Painter({},a.extend({},{region:{width:d.el.width,height:d.el.height},splitSpace:d.options.splitSpace,width:d.options.KLineSingleWidth})),c=e.getMaxPaintItemsLength();this.options.size=c&&c+b||0,d=null,e=null},setTechnical:function(){var a="lineIndex"in this.options?this.options.lineIndex:0,b=this.el.find(".technical");a>0?c.graphic&&(b.css({left:(c.graphic.el.width-c.graphic.options.curveChart.region.width/2)/2-50,top:(c.graphic.options.curveChart.region.height+c.graphic.options.curveChart.scalerTop.region.height+(c.graphic.options.curveChart.scalerBottom.region.height-30)/2)/2}),b.show()):b.hide()},setCanvasHeight:function(){a(".main-container,.canvas-container").css("height",a(window).height()-a(".top-container").height()-bottomHeight+"px");var b=this.el.find(".canvas-container"),c=b.width(),d=b.height();b.find("canvas").attr({width:2*c,height:2*d}).css({width:c,height:d})},getSiblingStockCode:function(){var c,b={};"1"==selfSelect?(b.order=order,b.sortField=sortField,b.code=curCode,c=common.getStockList(arrFllowUrl[2]),b.codeStr=c?c:""):(b.order=order,b.sortField=sortField,b.code=curCode,b.type=type),a.ajax({url:"/RoxMarket/detail/getNeighbor.do",type:"post",data:b,dataType:"json",beforeSend:function(){myScroll.disable()},success:function(a){a&&a.list&&a.list.length>0&&(curCode=a.list[1].pcode||"",prevCode=a.list[0].pcode||"",nextCode=a.list[2].pcode||"",myScroll.enable())}})},setHeaderAutoWidth:function(){var b=a(window).width(),c=1.3*this.el.find(".header .mid").width(),d=this.el.find(".left .btn").width(),e=Math.floor((b-c)/2/2-d-4);this.el.find(".header .left div").css("margin",["10px",e+"px",0,0].join(" ")),this.el.find(".header .left div").first().css("margin",["10px",e+"px",0,"10px"].join(" ")),this.el.find(".header .right div").css("margin",["10px",0,0,e+"px"].join(" ")),this.el.find(".header .right div").last().css("margin",["10px","10px",0,e+"px"].join(" "))},bindStock:function(b,d,f){try{this.setMaxSize(),d.size=this.options.size,c.close(),this.unBindKlineButton(),jMessage.close(),a.ajax({url:b+"&size="+(d.size||0),type:"post",async:!0,dataType:"json",timeout:6e4,beforeSend:function(){f!==!1&&a(".waiting").show()},error:function(a,b){jMessage.open({title:"",content:"timeout"==b?"数据加载超时，请稍后再试!":"数据加载异常，请稍后再试!",model:"alert",autoHide:!1}),window.pageObject.bindKlineButton()},success:function(f){c.close(),c.open(b,a.extend({},d,{data:f})),e.setHeaderAutoWidth()}})}catch(h){jMessage.open({title:"",content:debug?h.message:"timeout"==h?"数据加载超时，请稍后再试!":"数据加载异常，请稍后再试!",model:"alert",autoHide:!1}),window.pageObject.bindKlineButton()}},filishGraphic:function(){a(".waiting").hide(),this.bindKlineButton()},unBindKlineButton:function(){a(".line-scroller>div>div").unbind("click")},bindKlineButton:function(){var b=this;a(".line-scroller>div>div").bind({click:function(){a(this).hasClass("selected")||(a(".line-scroller>div>div").removeClass("selected"),a(this).addClass("selected"),b.options.lineIndex=a(this).parent().index(),b.bindStock(d[b.options.lineIndex]+b.options.stockCode,{flag:b.options.lineIndex,tech:b.options.tech}))}})},bindEvents:function(){var b=this.options.stockCode,c=this,f="onorientationchange"in window?"orientationchange":"resize",g=common.getStockList(arrFllowUrl[2]);a(window).bind(f,function(){a(".page-detail,.top-container,.main-container").css("width",a(window).width()+"px"),a(".scroller").css("width",3*a(window).width()+"px"),myScroll.refresh(),myScroll.scrollToPage(1,0,0),e.setHeaderAutoWidth(),e.setCanvasHeight(),c.bindStock(d[c.options.lineIndex]+c.options.stockCode,{flag:c.options.lineIndex,tech:c.options.tech})}),g&&-1!==g.indexOf(b)?this.el.find(".addMyBox").removeClass("add").addClass("del"):this.el.find(".addMyBox").removeClass("del").addClass("add"),this.el.find(".addMyBox").addClickEvent(function(){var e;0==g.length?[]:g.split(","),a(this).hasClass("add")?(e=common.addStock(arrFllowUrl[0],b),e&&(a(this).removeClass("add").addClass("del"),jMessage.open({title:"",content:"添加自选成功",model:"alert",icon:"success",autoHide:!0}))):(e=common.delStock(arrFllowUrl[1],b),e&&(a(this).removeClass("del").addClass("add"),jMessage.open({title:"",content:"删除自选成功",model:"alert",icon:"info",autoHide:!0})))}),this.bindKlineButton(),this.el.find(".f10").addClickEvent(function(){window.location.href="/RoxMarket/news/fs.do?code="+c.options.stockCode.replace("sz","").replace("sh","")}),this.el.find(".search").addClickEvent(function(){window.location.href="/RoxMarket/search/searchPage.do"}),this.el.find(".left .btn-def").addClickEvent(function(){window.location.href=tradeServerHomePath+"/limitBuyPage.do?code="+c.options.stockCode.replace("sz","").replace("sh","")}),this.el.find(".right .btn-def").addClickEvent(function(){window.location.href=tradeServerHomePath+"/limitSellPage.do?code="+c.options.stockCode.replace("sz","").replace("sh","")}),this.el.find(".technical").addClickEvent(function(b){var f=c.el.find(".technical");a(".mBox").show(),a(".technicalBox").css({opacity:"1",left:f.offset().left-(a(".technicalBox").width()-f.width())/2+"px",top:f.offset().top-a(".technicalBox").height()+"px"}),a(".technicalBox").children("div").each(function(){a(this).html()==curTechnical&&a(this).addClass("curr").siblings().not(this).removeClass("curr"),a(this).delClickEvent().addClickEvent(function(b){a(this).addClass("curr").siblings().not(this).removeClass("curr"),myScroll.enable(),a(".technicalBox").css({opacity:"0"}),a(".mBox").hide(),curTechnical=a(this).html(),c.options.tech=curTechnical,e.bindStock(d[c.options.lineIndex]+c.options.stockCode,{flag:c.options.lineIndex,tech:c.options.tech}),b.stopPropagation()})}),setTimeout(function(){a(".mBox").delClickEvent().addClickEvent(function(b){myScroll.enable(),a(".technicalBox").css({opacity:"0"}),a(".mBox").hide(),a(".mBox").off("click touchend touchstart"),b.stopPropagation()})},750),b.stopPropagation()}).off("touchstart").on("touchstart",function(){myScroll.refresh(),myScroll.disable()})},unBindEvents:function(){var b="onorientationchange"in window?"orientationchange":"resize";a(window).unbind(b),this.el.find(".addMyBox").unbind(),this.unBindKlineButton(),this.el.find(".f10").unbind(),this.el.find(".search").unbind(),this.el.find(".left .btn-def,.right .btn-def").unbind(),this.el.find(".technical").unbind()}}}(Zepto),Zepto(function(){window.pageObject.init({el:".selectedDetail",stockCode:curCode,lineIndex:0,tech:curTechnical})});