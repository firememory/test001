var socketChannel={channelGate:null,connect:function(a){try{if(socketChannel.close(),"WebSocket"in window)socketChannel.websocket=new WebSocket(a);else{if(!("MozWebSocket"in window))return;socketChannel.websocket=new MozWebSocket(a)}socketChannel.websocket.onopen=function(){},socketChannel.websocket.onclose=function(){},socketChannel.websocket.onmessage=function(a){var b=JSON.parse(a.data);pageObject.renderData(b.list,!1),b.szList&&pageObject.renderSelectedTickets(b.szList)}}catch(b){socketChannel.close()}finally{}},initConnection:function(a){var c,d,b="";a?(c="/RoxMarket/myFollow?",d=pageObject.options.selfCondition,b="size="+pageObject.options.pageSize+"&"):(c="/RoxMarket/market?",d=pageObject.options.condition);for(e in d)b+=e+"="+d[e]+"&";b=b.slice(0,-1);try{socketChannel.connect("ws://"+window.location.host+c+b)}catch(e){socketChannel.connect("wss://"+window.location.host+c+b)}},open:function(){("MozWebSocket"in window||"WebSocket"in window)&&!$.isAndroidOS()?socketChannel.initConnection(pageObject.options.selfSelect):socketChannel.channelGate=window.setTimeout(function(){var a=1,b=pageObject.options;a=b.selfSelect?b.selfCondition.cp:b.condition.cp,pageObject.searchForTargetPageData({cp:a},!1,!1)},5e3)},close:function(){try{socketChannel&&socketChannel.websocket?socketChannel.websocket.close():socketChannel&&socketChannel.channelGate&&window.clearTimeout(socketChannel.channelGate)}catch(a){}finally{socketChannel.websocket=null,socketChannel.channelGate=null}}},pageObject={options:{a:"",refresh:!1,dataLineHeight:50,pageSize:0,condition:{size:0,cp:1,type:"-2",order:1,sortField:""},selfCondition:{cp:1,order:1,sortField:"",codeStr:""},pageNumber:1,cp:1,selfSelect:!1,market:"-2"},reSetCondition:function(){this.options.market="-2",$.extend(this.options.condition,{pageNumber:1,cp:1,type:"-2",order:1,sortField:""}),$.extend(this.options.selfCondition,{cp:1,order:1,sortField:"",codeStr:""})},getParams:function(){var a=this.options,b=common.getHash(["selfSelect","market","sort","order","direction","page"]);"1"==b.selfSelect?(a.selfSelect=!0,b.page&&!isNaN(b.page)&&b.page>0&&(a.selfCondition.cp=b.page),b.direction&&"1"==b.direction?a.selfCondition.order="1":b.direction&&"0"==b.direction&&(a.selfCondition.order="0"),b.order&&(a.selfCondition.sortField=b.order)):(a.selfSelect=!1,b.page&&!isNaN(b.page)&&b.page>0&&(a.condition.cp=b.page),b.sort&&(a.condition.type=b.sort),b.direction&&"1"==b.direction?a.condition.order="1":b.direction&&"0"==b.direction&&(a.condition.order="0"),b.order&&(a.condition.sortField=b.order),b.market&&(a.market=b.market))},setContent:function(){var a=this.options,b="",c="<li data-type='$type' style='width:$width' $class>$name</li>";this.getTicketSorts(!1),$(".footer>div>div").removeClass("selected"),a.selfSelect?($(".market-title, .selected-ticket").hide(),$(".tickets-sort").css({height:0}),$(".ticket-name li").eq(0).html("我的自选"),$("#trend").hide(),$("#favorite").show(),$(".info-scroller").css("min-width","300px"),$(".zixuan").addClass("selected"),$("body").removeClass("page-SCHQ"),$("#favorite .first div").removeClass("selected order-up order-down"),a.selfCondition.sortField&&$("#favorite .first div").filter(function(){return $(this).attr("field")==a.selfCondition.sortField}).attr("order",a.selfCondition.order).addClass("selected").addClass("1"==a.selfCondition.order?"order-down":"order-up")):($(".market-title, .selected-ticket").show(),$(".ticket-name li").eq(0).html("大盘指数"),$("#trend").show(),$("#favorite").hide(),$(".info-scroller").css("min-width","900px"),$(".market").addClass("selected"),$("body").addClass("page-SCHQ"),$(".market-sort li").removeClass("selected hasChild"),$(".market-sort li").each(function(){if($(this).attr("data-type")===a.market&&($(this).addClass("selected"),$(this).data("childs"))){$(this).addClass("hasChild"),data=$(this).data("childs")&&$(this).data("childs").split(",")||[],width=Math.floor(1e4*(1/data.length))/100,c=c.replace(/\$width/,width+"%");for(var d=0,e=data.length;e>d;d++)n=data[d].split("|")||[],b+=c.replace(/\$name/,n[0]).replace(/\$type/,n[1]).replace(/\$class/,a.condition.type==n[1]?"class='selected'":"");$(".tickets-sort").html(b)}}),0==$(".market-sort li.selected").length&&$(".market-sort li").eq(0).addClass("selected"),$(".market-title").addClass("bottom-line"),$("#trend .first div").removeClass("selected order-up order-down"),a.condition.sortField&&$("#trend .first div").filter(function(){return $(this).attr("field")==a.condition.sortField}).attr("order",a.condition.order).addClass("selected").addClass("1"==a.condition.order?"order-down":"order-up")),this.setSelectedTicketsWidth()},init:function(){this.getParams(),this.setContent(),this.initDataArea(),this.setDefaultSelfTickets(),this.bindAllEvents(),this.searchForTargetPageData()},setDefaultSelfTickets:function(a){var a=a||"sz399001,sh000001",b=$.cookie("Quoetions_Openid"),c=common.getStockList(arrFllowUrl[2]+"?openId="+escape(b));null===c?common.addStock(arrFllowUrl[0]+"?openId="+escape(b),a):common.clearupCookies()},setSelectedTicketsWidth:function(){var b,a=$("body").width();a=100>a?100:a,b=Math.floor(a/100),400>a?$("#selected-ticket ul").css("width",4*a/b+"px"):$("#selected-ticket ul").css("width",a+"px"),$(".selected-ticket").delegateClick("li",function(){timeEnd=new Date,100>timeEnd-timeStart&&$(this).attr("pcode")&&!moving&&(window.location="/RoxMarket/detail/view.do?code="+$(this).attr("pcode"))})},initDataArea:function(){var a=0,b=$(".ticket-info").filter(function(){return"none"!=$(this).css("display")}).find(".first").height();a=Math.floor(($(".data-area").height()-b)/this.options.dataLineHeight),this.options.pageSize=a,this.options.condition.size=this.options.pageSize,$("#info-container").css({"min-height":$("#wrapper").height()})},adjustItemHeight:function(){var a=this.options.pageSize,b=$(".ticket-info").filter(function(){return"none"!=$(this).css("display")}),c=b.find(".first").height();this.itemHeight=Math.round(($(".data-area").height()-c)/a)},getTicketSorts:function(a){var b="<li data-type='$type'>$name</li>",c="";$.ajax({url:"/RoxMarket/sync/getType.do",type:"post",dataType:"json",async:a===!1?!1:!0,success:function(a){if(!(a.length<1)){for(var f=0,g=a.length;g>f;f++)c+=b.replace(/\$name/,a[f].name).replace(/\$type/,a[f].type);$(".market-sort").html(c),$(".tickets-sort").html(""),$(".market-sort li").each(function(b){var e,f,c="",d=a[b].child;for(e=0,f=d.length;f>e;e++)c+=d[e].name+"|"+d[e].type+",";c=c.slice(0,-1),$(this).data("childs",c)})}}})},getTicketMinsKInfo:function(){var b,a=this.touches&&this.touches[0]||this,c=pageObject.options;timeEnd=new Date,b=$(a.target).attr("pcode")||$(a.target).closest("li").attr("pcode"),$(a.target).hasClass("delete")||$(a.target).is("img")||(b&&1==c.selfSelect?window.location="/RoxMarket/detail/view.do?code="+b+"&order="+c.condition.order+"&sortField="+c.condition.sortField:b&&0==c.selfSelect&&(window.location="/RoxMarket/detail/view.do?code="+b+"&type="+c.condition.type+"&order="+c.condition.order+"&sortField="+c.condition.sortField))},bindAllEvents:function(){var a=this;$(".market-sort, .tickets-sort").delegateClick("li",function(){var d,e,g,h,i,a="<li data-type='$type' style='width:$width'>$name</li>",b="",c=0;if($(".tickets-sort"),$(this).parent(".market-sort").length>0){if($(this).hasClass("selected"))$(this).attr("data-childs")&&($(".tickets-sort").animate({height:40},300),$(this).addClass("open").siblings().removeClass("open")),$(".tickets-sort").height()>1&&($(".tickets-sort").animate({height:0},300),$(this).removeClass("open"));else{for(pageObject.reSetCondition(),$("#trend .first div").attr("order",""),$("#trend .first div").removeClass("selected order-up order-down"),d=$(this).data("childs")&&$(this).data("childs").split(",")||[],c=Math.floor(1e4*(1/d.length))/100,a=a.replace(/\$width/,c+"%"),g=0,h=d.length;h>g;g++)e=d[g].split("|")||[],b+=a.replace(/\$name/,e[0]).replace(/\$type/,e[1]);$(".tickets-sort").html(b),pageObject.options.a=$(this).html(),$(".ticket-name li:first-child").html($(this).html()),pageObject.options.condition.type=$(this).attr("data-type"),$(".tickets-sort").height()>1&&($(".tickets-sort").animate({height:0},300),$(this).removeClass("open")),pageObject.options.market=$(this).attr("data-type"),pageObject.searchForTargetPageData()}$(this).attr("data-childs")?$(this).addClass("hasChild").siblings().removeClass("hasChild"):$(this).siblings().removeClass("hasChild"),$(this).addClass("selected").siblings().removeClass("selected")}$(this).parent(".tickets-sort").length>0&&(pageObject.reSetCondition(),$("#trend .first div").attr("order",""),$("#trend .first div").removeClass("selected order-up order-down"),$(this).addClass("selected").siblings().removeClass("selected"),i=pageObject.options.a+$(this).html(),i.length>4&&80===$(".ticket-name").width()&&(i=i.slice(0,3)+"..."),$(".ticket-name li:first-child").html(i),$(".tickets-sort").animate({height:0},300),$(".market-sort li").removeClass("open"),pageObject.options.condition.type=$(this).attr("data-type"),pageObject.options.market=$(".market-sort li.selected").attr("data-type"),pageObject.searchForTargetPageData())}),$(document).addClickEvent(function(a){var a=a.touches&&a.touches[0]||a,b=a.target||a.srcElement;$(b).parent(".tickets-sort").length>0||$(b).parent(".market-sort").length>0||($(".tickets-sort").animate({height:0},300),$(".market-sort li").removeClass("open"))}),$(".footer > div > div").addClickEvent(function(a){return a.preventDefault(),$(this).hasClass("selected")?!1:(pageObject.reSetData(),$("body").toggleClass("page-SCHQ"),pageObject.initDataArea(),pageObject.reSetCondition(),$("div",".footer").removeClass("selected"),$(this).addClass("selected"),$(this).hasClass("zixuan")?($(".market-title, .selected-ticket").hide(),$(".tickets-sort").css({height:0}),$(".ticket-name li").eq(0).html("我的自选"),$("#trend").hide(),$("#favorite").show(),$("#favorite .first div").attr("order",""),$("#favorite .first div").removeClass("selected order-up order-down"),$(".info-scroller").css("min-width","300px"),pageObject.options.selfSelect=!0):($(".market-title, .selected-ticket").show(),$(".ticket-name li").eq(0).html("大盘指数"),$("#trend").show(),$("#favorite").hide(),$("#trend .first div").attr("order",""),$("#trend .first div").removeClass("selected order-up order-down"),$(".info-scroller").css("min-width","900px"),$(".market-sort li").removeClass("selected hasChild").eq(0).addClass("selected"),$(".tickets-sort").html(""),$(".market-title").addClass("bottom-line"),pageObject.options.selfSelect=!1),pageObject.searchForTargetPageData(),void 0)}),$(".ticket-info").delegateClick(".delete",function(a){var b,c=$.cookie("Quoetions_Openid");a.preventDefault(),b=common.delStock(arrFllowUrl[1]+"?openId="+escape(c),$(this).closest("li").attr("pcode")),b&&(jMessage.open({title:"",content:"取消自选成功",model:"alert",autoHide:!0}),pageObject.searchForTargetPageData())}),$(".ticket-name, .ticket-info").delegateClick("li",function(b){a.getTicketMinsKInfo.call(b)}),$(".ticket-info").delegateClick(".first div",function(a){var b;b=pageObject.options.selfSelect?pageObject.options.selfCondition:pageObject.options.condition,a.preventDefault(),b.sortField=$(this).attr("field"),$(this).siblings().removeClass("selected order-up order-down"),$(this).hasClass("selected")?"0"==$(this).attr("order")?(b.order=1,$(this).attr("order","1").removeClass("order-up").addClass("order-down")):(b.order=0,$(this).attr("order","0").removeClass("order-down").addClass("order-up")):(b.order=$(this).attr("order")||0,$(this).attr("order",b.order),$(this).addClass("selected "+(0==b.order?"order-up":"order-down"))),pageObject.searchForTargetPageData()})},searchForTargetPageData:function(a,b,c){var e,f,g=pageObject.options,h={},i=$.cookie("Quoetions_Openid");g.selfSelect===!0?$.extend(g.selfCondition,a):$.extend(g.condition,a),g.selfSelect?(f=common.getStockList(arrFllowUrl[2]+"?openId="+escape(i)),h.codeStr=f?f:"",h.size=g.pageSize,g.selfCondition.codeStr=h.codeStr,h=$.extend({},h,g.selfCondition),e="/RoxMarket/follow/myFollow.do?",common.setHash(["1","","",g.selfCondition.sortField,g.selfCondition.order,g.selfCondition.cp])):(h=pageObject.options.condition,e="/RoxMarket/sync/market.do?",common.setHash(["0",g.market,g.condition.type,g.condition.sortField,g.condition.order,g.condition.cp])),socketChannel.close(),$.ajax({type:"get",url:e,data:h,dataType:"json",beforeSend:function(){b!==!1&&($(".loading").show(),pageObject.reSetData(),myScroll.refresh(),iscroller.refresh())},success:function(a){var e="none"==$("#trend").css("display")?0:1;$(".loading").hide(),a&&"undefined"!=typeof a.list&&(g.selfSelect?(g.cp=g.selfCondition.cp,g.pageNumber=f&&Math.ceil(f.split(",").length/g.pageSize)||1):(g.cp=g.condition.cp,g.pageNumber=a.info.allSize||1),pageObject.renderData(a.list,c),pageObject.options.selfSelect||pageObject.renderSelectedTickets(a.szList),socketChannel.close(),socketChannel.open(),$("#info-container").css({"min-height":$("#wrapper").height(),height:$(".ticket-info").eq(e).height()}),0!=c&&(myScroll.scrollTo(0,-pullDownOffset),myScroll.refresh(),iscroller.refresh(),selectedTicket.refresh(),myScroll.maxScrollY=myScroll.maxScrollY+pullUpOffset))},error:function(){console.log(arguments)}})},renderData:function(a,b){function m(a){return a&&0!=a?a:"--"}var i,j,k,l,c='<li pcode="$pcode" $style><div>$name</div><div>$code</div></li>',d='<li pcode="$pcode" $style><div>&nbsp;</div><div class="$upOrDown">$zx</div><div class="$zxdeUpOrDown">$zde</div><div class="$zxdfUpOrDown">$zdf</div><div>$ze</div><div>$zl</div><div>$zs</div><div class="$upOrDown">$jk</div><div class="$upOrDown">$zg</div><div class="$upOrDown">$zd</div></li>',e='<li pcode="$pcode" $style><div>&nbsp;</div><div class="$upOrDown">$zx</div><div class="$zxdfUpOrDown"><span>$zdf</span></div><div class="delete"><img src="public/images/delete.png" /></div></li>',f="",g="",h="";for(b!==!1&&this.adjustItemHeight(),i=0,j=a.length;j>i;i++)f+=c.replace(/\$style/,"style='height:"+(this.itemHeight||this.options.dataLineHeight)+"px'").replace(/\$name/,a[i].mc).replace(/\$code/,a[i].dm).replace(/\$pcode/,a[i].pcode),g+=d.replace(/\$style/,"style='height:"+(this.itemHeight||this.options.dataLineHeight)+"px'").replace(/\$zx/,m(a[i].zx)).replace(/\$zde/,m(a[i].zde)).replace(/\$zdf/,m(a[i].zdf)).replace(/\$ze/,m(a[i].ze)).replace(/\$zl/,m(a[i].zl)).replace(/\$zs/,m(a[i].zs)).replace(/\$jk/,m(a[i].jk)).replace(/\$zg/,m(a[i].zg)).replace(/\$zd/,m(a[i].zd)).replace(/\$upOrDown/g,a[i].zde<0||a[i].zdf<0?"down":"up").replace(/\$zxdeUpOrDown/,a[i].zde<0?"down":"up").replace(/\$zxdfUpOrDown/,a[i].zdf<0?"down":"up").replace(/\$pcode/,a[i].pcode),h+=e.replace(/\$style/,"style='height:"+(this.itemHeight||this.options.dataLineHeight)+"px'").replace(/\$zx/,m(a[i].zx)).replace(/\$zdf/,m(a[i].zdf)).replace(/\$upOrDown/g,a[i].zde<0||a[i].zdf<0?"down":"up").replace(/\$zxdfUpOrDown/,a[i].zdf<0?"down":"up").replace(/\$pcode/,a[i].pcode);k=[],l="none"==$("#trend").css("display")?"favorite":"trend",b===!1&&$("#"+l+" li").each(function(b){if(0!=b){var c=$(this).children("div").eq(1).text(),d=a&&a[b-1].zx.toString();k[b-1]=!1,c.length>0&&d.length>0&&!isNaN(c)&&!isNaN(d)&&Number(d)!=Number(c)&&(k[b-1]=!0)}}),"favorite"==l?$("#favorite").html($("#favorite li").get(0).outerHTML+h):$("#trend").html($("#trend li").get(0).outerHTML+g),$(".ticket-name").html($(".ticket-name li").get(0).outerHTML+f),b===!1&&$("#"+l+" li").each(function(a){if(0!=a&&k[a-1]){var c=($(this).children("div").eq(1).addClass("pricechangeshow"),this);setTimeout(function(){$(c).children("div").eq(1).removeClass("pricechangeshow").addClass("pricechangehide")},1e3)}}),myScroll.refresh(),myScroll.maxScrollY=myScroll.maxScrollY+pullUpOffset},renderSelectedTickets:function(a){var d,b='<li pcode="$pcode"><span  class="$upOrDown new"><div>$name</div><div class="change">$zx</div><div class="pctchange">$zde($zdf)</div></span></li>',c="";for(d=0;d<a.length;d++)c+=b.replace(/\$name/,a[d].name).replace(/\$zx/,a[d].zx).replace(/\$zde/,0==a[d].zde?"--":a[d].zde>0?"+"+a[d].zde:a[d].zde).replace(/\$zdf/,0==a[d].zdf?"--":(a[d].zdf>0?"+"+a[d].zdf:a[d].zdf)+"%").replace(/\$upOrDown/,a[d].zde<0?"down":"up").replace(/\$pcode/,a[d].pcode);$(".selected-ticket ul").html(c)},reSetData:function(){$(".ticket-name").html($(".ticket-name li").get(0).outerHTML),$("#trend").html($("#trend li").get(0).outerHTML),$("#favorite").html($("#favorite li").get(0).outerHTML)}};$(document).ready(function(){pageObject.init(),$(window).bind("resize",function(){pageObject.initDataArea(),pageObject.setSelectedTicketsWidth(),pageObject.searchForTargetPageData()})});